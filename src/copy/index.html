<!DOCTYPE html>
<html>

<head>
	<title>Audio Player | by Wessels de Wet</title>
	<link rel="stylesheet" type="text/css" href="css/main.css">
</head>

<body>

	<!-- <nav class="navbar navbar-expand-lg navbar-light bg-light">
		<a class="navbar-brand" href="#">Navbar</a>
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
			aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>

		<div class="collapse navbar-collapse" id="navbarSupportedContent">
			<ul class="navbar-nav mr-auto">
				<li class="nav-item active">
					<a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="#">Link</a>
				</li>
				<li class="nav-item dropdown">
					<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
						data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
						Dropdown
					</a>
					<div class="dropdown-menu" aria-labelledby="navbarDropdown">
						<a class="dropdown-item" href="#">Action</a>
						<a class="dropdown-item" href="#">Another action</a>
						<div class="dropdown-divider"></div>
						<a class="dropdown-item" href="#">Something else here</a>
					</div>
				</li>
				<li class="nav-item">
					<a class="nav-link disabled" href="#">Disabled</a>
				</li>
			</ul>
			<form class="form-inline my-2 my-lg-0">
				<input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
				<button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
			</form>
		</div>
	</nav> -->

	<div class="container-fluid player-container">
		<div class="row h-100">
			<div class="col-12 p-0">
				<div class="player-wrapper h-100">
					<div class="player-head">
						<h3 class="text-center py-3">This is some header text</h3>
					</div>
					<div class="player-viewer text-center py-5">
						<img src="#" alt="Cover Image" class="img-fluid">
					</div>
					<div class="audio-player fixed-bottom">
						<div class="timeline">
							<div class="progress"></div>
						</div>
						<div class="controls">
							<div class="play-container">
								<div class="toggle-play play">
								</div>
							</div>
							<div class="time">
								<div class="current">0:00</div>
								<div class="divider">/</div>
								<div class="length"></div>
							</div>
							<!--     credit for icon to https://saeedalipoor.github.io/icono/ -->
							<div class="volume-container">
								<div class="volume-button">
									<div class="volume icono-volumeMedium">&#xe038;</div>
								</div>

								<div class="volume-slider">
									<div class="volume-percentage"></div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Scripts -->
	<script src="js/jquery.js"></script>
	<script src="js/mediaelement-and-player.min.js"></script>
	<script src="js/detects.js"></script>
	<script src="js/another-file.js"></script>
	<script src="js/main.polyfills.js"></script>
	<script src="js/bootstrap.js"></script>

	<script>
		$(document).ready(function () {
			// Possible improvements:
			// - Change timeline and volume slider into input sliders, reskinned
			// - Change into Vue or React component
			// - Be able to grab a custom title instead of "Music Song"
			// - Hover over sliders to see preview of timestamp/volume change

			const audioPlayer = document.querySelector(".audio-player");
			const audio = new Audio(
				"https://ia800905.us.archive.org/19/items/FREE_background_music_dhalius/backsound.mp3"
			);
			//credit for song: Adrian kreativaweb@gmail.com

			console.dir(audio);

			audio.addEventListener(
				"loadeddata",
				() => {
					audioPlayer.querySelector(".time .length").textContent = getTimeCodeFromNum(
						audio.duration
					);
					audio.volume = .75;
				},
				false
			);

			//click on timeline to skip around
			const timeline = audioPlayer.querySelector(".timeline");
			timeline.addEventListener("click", e => {
				const timelineWidth = window.getComputedStyle(timeline).width;
				const timeToSeek = e.offsetX / parseInt(timelineWidth) * audio.duration;
				audio.currentTime = timeToSeek;
			}, false);

			//click volume slider to change volume
			const volumeSlider = audioPlayer.querySelector(".controls .volume-slider");
			volumeSlider.addEventListener('click', e => {
				const sliderWidth = window.getComputedStyle(volumeSlider).width;
				const newVolume = e.offsetX / parseInt(sliderWidth);
				audio.volume = newVolume;
				audioPlayer.querySelector(".controls .volume-percentage").style.width = newVolume * 100 + '%';
			}, false)

			//check audio percentage and update time accordingly
			setInterval(() => {
				const progressBar = audioPlayer.querySelector(".progress");
				progressBar.style.width = audio.currentTime / audio.duration * 100 + "%";
				audioPlayer.querySelector(".time .current").textContent = getTimeCodeFromNum(
					audio.currentTime
				);
			}, 500);

			//toggle between playing and pausing on button click
			const playBtn = audioPlayer.querySelector(".controls .toggle-play");
			playBtn.addEventListener(
				"click",
				() => {
					if (audio.paused) {
						playBtn.classList.remove("play");
						playBtn.classList.add("pause");
						audio.play();
					} else {
						playBtn.classList.remove("pause");
						playBtn.classList.add("play");
						audio.pause();
					}
				},
				false
			);

			audioPlayer.querySelector(".volume-button").addEventListener("click", () => {
				const volumeEl = audioPlayer.querySelector(".volume-container .volume");
				audio.muted = !audio.muted;
				if (audio.muted) {
					volumeEl.classList.remove("icono-volumeMedium");
					volumeEl.classList.add("icono-volumeMute");
				} else {
					volumeEl.classList.add("icono-volumeMedium");
					volumeEl.classList.remove("icono-volumeMute");
				}
			});

			//turn 128 seconds into 2:08
			function getTimeCodeFromNum(num) {
				let seconds = parseInt(num);
				let minutes = parseInt(seconds / 60);
				seconds -= minutes * 60;
				const hours = parseInt(minutes / 60);
				minutes -= hours * 60;

				if (hours === 0) return `${minutes}:${String(seconds % 60).padStart(2, 0)}`;
				return `${String(hours).padStart(2, 0)}:${minutes}:${String(
					seconds % 60
				).padStart(2, 0)}`;
			}

		});
	</script>

</body>

</html>